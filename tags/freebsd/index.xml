<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Freebsd on jeakob</title><link>https://jeakob.github.io/blog/tags/freebsd/</link><description>Recent content in Freebsd on jeakob</description><generator>Hugo</generator><language>en-us</language><lastBuildDate>Fri, 19 Dec 2025 21:08:00 +0000</lastBuildDate><atom:link href="https://jeakob.github.io/blog/tags/freebsd/index.xml" rel="self" type="application/rss+xml"/><item><title>HP Microserver Gen 8 - FreeBSD Bootloader</title><link>https://jeakob.github.io/blog/posts/hp-microserver-freebsd-boot/</link><pubDate>Fri, 19 Dec 2025 21:08:00 +0000</pubDate><guid>https://jeakob.github.io/blog/posts/hp-microserver-freebsd-boot/</guid><description>&lt;h2 id="the-problem">The Problem&lt;/h2>
&lt;p>The HP MicroServer Gen8 has limited and inflexible boot options. In many configurations, it cannot reliably boot an operating system directly from certain internal drives (most commonly SSDs installed in the optical bay or via internal ports). As a result, the system may fail to start even though the OS is installed correctly and the hardware is otherwise functional. This allowed me to install TrueNAS Scale on an SSD plugged into the internal SATA port.&lt;/p>
&lt;h2 id="the-solution">The Solution&lt;/h2>
&lt;p>This guide explains how to install FreeBSD on external boot media that the HP MicroServer Gen8 can load at startup. Once loaded, the FreeBSD bootloader is used to select a configured internal drive—typically an SSD, which then boots the operating system of your choice.&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>Tip:&lt;/strong> It’s best to unplug all hard drives first. I recommend installing FreeBSD on the internal USB or microSD card.&lt;/p>&lt;/blockquote>
&lt;p>Press Enter
&lt;img src="https://jeakob.github.io/blog/1_FreeBSD_image.png" width="1200" height="650">&lt;/p>
&lt;p>Press Enter again
&lt;img src="https://jeakob.github.io/blog/2_FreeBSD_image.png" width="1200" height="650">&lt;/p>
&lt;p>Select where you would like install FreeBSD&lt;/p>
&lt;figure class="image">
 &lt;img src="https://jeakob.github.io/blog/3_FreeBSD_image.png" width="354" height="245">
&lt;/figure>
&lt;p>After installing FreeBSD, the installer will offer to drop you into a shell before rebooting. Accept this option. Once in the shell, you&amp;rsquo;ll need to prepare your boot drive. In this example, we&amp;rsquo;re using &lt;code>da1&lt;/code> as the boot drive - adjust this if your drive has a different identifier. First, destroy any existing partitions, then create a fresh GPT partition table:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>gpart destroy -F da1
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>gpart create -s GPT da1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="install-the-bootloader">Install the bootloader:&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>gpart bootcode -b /boot/boot0 da1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Assuming all four LFF drive bays are populated, configure the bootloader to use the fifth drive (the SSD) and set it as the default boot option:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>boot0cfg -Bv -o setdrv -d 0x84 -s &lt;span style="color:#ae81ff">5&lt;/span> da1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>0x84&lt;/code> refers to the fifth BIOS drive. Use these if you have others:&lt;/p>
&lt;ul>
&lt;li>&lt;code>0x80&lt;/code> – for just the SSD (though I suppose that’s redundant)&lt;/li>
&lt;li>&lt;code>0x81&lt;/code> – one other drive installed&lt;/li>
&lt;li>&lt;code>0x82&lt;/code> – two other drives installed&lt;/li>
&lt;li>&lt;code>0x83&lt;/code> – three other drives isntalled&lt;/li>
&lt;li>&lt;code>0x84&lt;/code> – all four other drives installed&lt;/li>
&lt;/ul>
&lt;p>The flags are:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sh" data-lang="sh">&lt;span style="display:flex;">&lt;span>-B install FreeBSD&lt;span style="color:#960050;background-color:#1e0010">&amp;#39;&lt;/span>s boot0 manager
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>-v like my blog, be verbose
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>-o setdrv refer to the disk by BIOS drive number
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>-d BIOS drive number
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>-s &lt;span style="color:#ae81ff">5&lt;/span> boot from second disk; in this &lt;span style="color:#66d9ef">case&lt;/span> the SSD 
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>There are several ways to approach this, but this method has been reliable for me for years.&lt;/p>
&lt;p>The main drawback is that if you add additional internal drives later, you’ll need to update the boot loader with the new address. If you forget, you can always boot from the FreeBSD installer and drop to a shell to update it again. In practice, though, most people already have all the drive bays populated, which is largely the point of these small systems.&lt;/p>
&lt;p>If your MicroServer still refuses to boot—as one of mine did—try connecting the bootable USB stick to one of the external USB 2.0 ports instead. One of my units may have a flaky internal port, but this workaround worked fine on another system here, as well as on the unit I keep at my dad’s place, which I’ve just realised I forgot to include in my homelab post.&lt;/p>
&lt;h3 id="boot-screenshot">Boot Screenshot:&lt;/h3>
&lt;img src="https://jeakob.github.io/blog/4_FreeBSD_image.png" width="1200" height="650">
&lt;h4 id="after-a-couple-of-seconds-you-will-see-grub">After a couple of seconds, you will see GRUB:&lt;/h4>
&lt;img src="https://jeakob.github.io/blog/FreeBSD_image.png" width="1200" height="650"></description></item></channel></rss>